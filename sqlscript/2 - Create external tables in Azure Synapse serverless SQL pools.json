{
	"name": "2 - Create external tables in Azure Synapse serverless SQL pools",
	"properties": {
		"folder": {
			"name": "Create metadata objects in Azure Synapse serverless SQL pools"
		},
		"content": {
			"query": "--Create an external table on protected data\nCREATE EXTERNAL TABLE populationExternalTable \n( \n    [country_code] VARCHAR (5) COLLATE Latin1_General_BIN2, \n    [country_name] VARCHAR (100) COLLATE Latin1_General_BIN2, \n    [year] smallint, \n    [population] bigint \n) \nWITH ( \n    LOCATION = 'csv/population/population.csv', \n    DATA_SOURCE = sqlondemanddemo, \n    FILE_FORMAT = QuotedCSVWithHeaderFormat \n); \n\n\nSELECT country_name, population \nFROM populationExternalTable \nWHERE [year] = 2020 \nORDER BY [population] DESC;\n\n--Create an external table on public data\nCREATE EXTERNAL TABLE Taxi ( \n    vendor_id VARCHAR(8000) ,\n    pickup_datetime DATETIME2,  \n    dropoff_datetime DATETIME2, \n    passenger_count INT, \n    trip_distance FLOAT, \n    fare_amount FLOAT, \n    tip_amount FLOAT, \n    tolls_amount FLOAT, \n    total_amount FLOAT \n) WITH ( \n        LOCATION = 'puYear=*/puMonth=*/*.parquet', \n        DATA_SOURCE = YellowTaxi, \n        FILE_FORMAT = ParquetFormat \n);\n\n--The tax EXTERNAL TABLE is bringing back NULLS so I'm going to create a CETAS equivalent\nCREATE EXTERNAL TABLE Taxi_CETAS\nWITH (\n    LOCATION = 'aggregated_data/Taxi/'\n)  \nAS\nFROM\n    OPENROWSET(\n        BULK 'parquet/taxi/year=*/month=*/*.parquet',\n        DATA_SOURCE = 'SqlOnDemandDemo',\n        FORMAT='PARQUET'\n    ) AS nyc\n\n\n--drop external table Taxi\nselect TOP 50 *  from Taxi\n\n SELECT TOP 20  *, nyc.filepath(1) AS [year], nyc.filepath(2) AS [month]\nFROM\n    OPENROWSET(\n        BULK 'parquet/taxi/year=*/month=*/*.parquet',\n        DATA_SOURCE = 'SqlOnDemandDemo',\n        FORMAT='PARQUET'\n    ) AS nyc\n\nEXEC sp_describe_first_result_set N'\n     SELECT TOP 20  *, nyc.filepath(1) AS [year], nyc.filepath(2) AS [month]\nFROM\n    OPENROWSET(\n        BULK ''parquet/taxi/year=*/month=*/*.parquet'',\n        DATA_SOURCE = ''SqlOnDemandDemo'',\n        FORMAT=''PARQUET''\n    ) AS nyc\n    '\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "Built-in",
				"databaseName": "30daychallenge_serverlessSQL"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}