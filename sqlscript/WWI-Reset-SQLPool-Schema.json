{
	"name": "WWI-Reset-SQLPool-Schema",
	"properties": {
		"folder": {
			"name": "Optimize DWH query performance"
		},
		"content": {
			"query": "create schema wwi\ngo\ncreate schema wwi_perf\ngo\ncreate schema wwi_staging\ngo\ncreate schema wwi_ml\ngo\n\nIF OBJECT_ID('wwi.DimCity', 'U') IS NOT NULL\n    DROP TABLE wwi.DimCity\nGO\n\n--Location was eliminated (data type geography not supported)\n\nCREATE TABLE [wwi].[DimCity]\n(\n    [CityKey] [int] NOT NULL,\n\t[WWICityID] [int] NOT NULL,\n\t[City] [nvarchar](50) NOT NULL,\n\t[StateProvince] [nvarchar](50) NOT NULL,\n\t[Country] [nvarchar](60) NOT NULL,\n\t[Continent] [nvarchar](30) NOT NULL,\n\t[SalesTerritory] [nvarchar](50) NOT NULL,\n\t[Region] [nvarchar](30) NOT NULL,\n\t[Subregion] [nvarchar](30) NOT NULL,\n\t[LatestRecordedPopulation] [bigint] NOT NULL,\n\t[ValidFrom] [datetime2](7) NOT NULL,\n\t[ValidTo] [datetime2](7) NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE\n)\nGO\n\nIF OBJECT_ID('wwi.DimCustomer', 'U') IS NOT NULL\n    DROP TABLE wwi.DimCustomer\nGO\n\nCREATE TABLE [wwi].[DimCustomer](\n\t[CustomerKey] [int] NOT NULL,\n\t[WWICustomerID] [int] NOT NULL,\n\t[Customer] [nvarchar](100) NOT NULL,\n\t[BillToCustomer] [nvarchar](100) NOT NULL,\n\t[Category] [nvarchar](50) NOT NULL,\n\t[BuyingGroup] [nvarchar](50) NOT NULL,\n\t[PrimaryContact] [nvarchar](50) NOT NULL,\n\t[PostalCode] [nvarchar](10) NOT NULL,\n\t[ValidFrom] [datetime2](7) NOT NULL,\n\t[ValidTo] [datetime2](7) NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE\n)\nGO\n\nIF OBJECT_ID('wwi.DimDate', 'U') IS NOT NULL\n    DROP TABLE wwi.DimDate\nGO\n\nCREATE TABLE [wwi].[DimDate](\n\t[Date] [date] NOT NULL,\n\t[DayNumber] [int] NOT NULL,\n\t[Day] [nvarchar](10) NOT NULL,\n\t[Month] [nvarchar](10) NOT NULL,\n\t[ShortMonth] [nvarchar](3) NOT NULL,\n\t[CalendarMonthNumber] [int] NOT NULL,\n\t[CalendarMonthLabel] [nvarchar](20) NOT NULL,\n\t[CalendarYear] [int] NOT NULL,\n\t[CalendarYearLabel] [nvarchar](10) NOT NULL,\n\t[FiscalMonthNumber] [int] NOT NULL,\n\t[FiscalMonthLabel] [nvarchar](20) NOT NULL,\n\t[FiscalYear] [int] NOT NULL,\n\t[FiscalYearLabel] [nvarchar](10) NOT NULL,\n\t[ISOWeekNumber] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE\n)\nGO\n\nIF OBJECT_ID('wwi.DimEmployee', 'U') IS NOT NULL\n    DROP TABLE wwi.DimEmployee\nGO\n\n-- Photo was eliminated (data type varbinary cannot participate in a columnstore index)\n\nCREATE TABLE [wwi].[DimEmployee](\n\t[EmployeeKey] [int] NOT NULL,\n\t[WWIEmployeeID] [int] NOT NULL,\n\t[Employee] [nvarchar](50) NOT NULL,\n\t[PreferredName] [nvarchar](50) NOT NULL,\n\t[IsSalesperson] [bit] NOT NULL,\n\t[ValidFrom] [datetime2](7) NOT NULL,\n\t[ValidTo] [datetime2](7) NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE\n)\nGO\n\nIF OBJECT_ID('wwi.DimPaymentMethod', 'U') IS NOT NULL\n    DROP TABLE wwi.DimPaymentMethod\nGO\n\nCREATE TABLE [wwi].[DimPaymentMethod](\n\t[PaymentMethodKey] [int] NOT NULL,\n\t[WWIPaymentMethodID] [int] NOT NULL,\n\t[PaymentMethod] [nvarchar](50) NOT NULL,\n\t[ValidFrom] [datetime2](7) NOT NULL,\n\t[ValidTo] [datetime2](7) NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE\n)\nGO\n\nIF OBJECT_ID('wwi.DimStockItem', 'U') IS NOT NULL\n    DROP TABLE wwi.DimStockItem\nGO\n\n-- Photo was eliminated (data type varbinary cannot participate in a columnstore index)\n\nCREATE TABLE [wwi].[DimStockItem](\n\t[StockItemKey] [int] NOT NULL,\n\t[WWIStockItemID] [int] NOT NULL,\n\t[Stock Item] [nvarchar](100) NOT NULL,\n\t[Color] [nvarchar](20) NOT NULL,\n\t[SellingPackage] [nvarchar](50) NOT NULL,\n\t[Buying Package] [nvarchar](50) NOT NULL,\n\t[Brand] [nvarchar](50) NOT NULL,\n\t[Size] [nvarchar](20) NOT NULL,\n\t[LeadTimeDays] [int] NOT NULL,\n\t[QuantityPerOuter] [int] NOT NULL,\n\t[IsChillerStock] [bit] NOT NULL,\n\t[Barcode] [nvarchar](50) NULL,\n\t[TaxRate] [decimal](18, 3) NOT NULL,\n\t[UnitPrice] [decimal](18, 2) NOT NULL,\n\t[RecommendedRetailPrice] [decimal](18, 2) NULL,\n\t[TypicalWeightPerUnit] [decimal](18, 3) NOT NULL,\n\t[ValidFrom] [datetime2](7) NOT NULL,\n\t[ValidTo] [datetime2](7) NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE\n)\nGO\n\nIF OBJECT_ID('wwi.DimSupplier', 'U') IS NOT NULL\n    DROP TABLE wwi.DimSupplier\nGO\n\n\nCREATE TABLE [wwi].[DimSupplier](\n\t[SupplierKey] [int] NOT NULL,\n\t[WWISupplierID] [int] NOT NULL,\n\t[Supplier] [nvarchar](100) NOT NULL,\n\t[Category] [nvarchar](50) NOT NULL,\n\t[PrimaryContact] [nvarchar](50) NOT NULL,\n\t[SupplierReference] [nvarchar](20) NULL,\n\t[PaymentDays] [int] NOT NULL,\n\t[PostalCode] [nvarchar](10) NOT NULL,\n\t[ValidFrom] [datetime2](7) NOT NULL,\n\t[ValidTo] [datetime2](7) NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE\n)\nGO\n\nIF OBJECT_ID('wwi.DimTransactionType', 'U') IS NOT NULL\n    DROP TABLE wwi.DimTransactionType\nGO\n\nCREATE TABLE [wwi].[DimTransactionType](\n\t[TransactionTypeKey] [int] NOT NULL,\n\t[WWITransactionTypeID] [int] NOT NULL,\n\t[TransactionType] [nvarchar](50) NOT NULL,\n\t[ValidFrom] [datetime2](7) NOT NULL,\n\t[ValidTo] [datetime2](7) NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = REPLICATE\n)\nGO\n\nIF OBJECT_ID('wwi.FactMovement', 'U') IS NOT NULL\n    DROP TABLE wwi.FactMovement\nGO\n\nCREATE TABLE [wwi].[FactMovement](\n\t[MovementKey] [bigint] IDENTITY(1,1) NOT NULL,\n\t[DateKey] [date] NOT NULL,\n\t[StockItemKey] [int] NOT NULL,\n\t[CustomerKey] [int] NULL,\n\t[SupplierKey] [int] NULL,\n\t[TransactionTypeKey] [int] NOT NULL,\n\t[WWIStockItemTransactionID] [int] NOT NULL,\n\t[WWIInvoiceID] [int] NULL,\n\t[WWIPurchaseOrderID] [int] NULL,\n\t[Quantity] [int] NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = HASH ([CustomerKey]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nGO\n\nIF OBJECT_ID('wwi.FactOrder', 'U') IS NOT NULL\n    DROP TABLE wwi.FactOrder\nGO\n\nCREATE TABLE [wwi].[FactOrder](\n\t[OrderKey] [bigint] IDENTITY(1,1) NOT NULL,\n\t[CityKey] [int] NOT NULL,\n\t[CustomerKey] [int] NOT NULL,\n\t[StockItemKey] [int] NOT NULL,\n\t[OrderDateKey] [date] NOT NULL,\n\t[PickedDateKey] [date] NULL,\n\t[SalespersonKey] [int] NOT NULL,\n\t[PickerKey] [int] NULL,\n\t[WWIOrderID] [int] NOT NULL,\n\t[WWIBackorderID] [int] NULL,\n\t[Description] [nvarchar](100) NOT NULL,\n\t[Package] [nvarchar](50) NOT NULL,\n\t[Quantity] [int] NOT NULL,\n\t[UnitPrice] [decimal](18, 2) NOT NULL,\n\t[TaxRate] [decimal](18, 3) NOT NULL,\n\t[TotalExcludingTax] [decimal](18, 2) NOT NULL,\n\t[TaxAmount] [decimal](18, 2) NOT NULL,\n\t[TotalIncludingTax] [decimal](18, 2) NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = HASH ([CustomerKey]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nGO\n\nIF OBJECT_ID('wwi.FactPurchase', 'U') IS NOT NULL\n    DROP TABLE wwi.FactPurchase\nGO\n\nCREATE TABLE [wwi].[FactPurchase](\n\t[PurchaseKey] [bigint] IDENTITY(1,1) NOT NULL,\n\t[DateKey] [date] NOT NULL,\n\t[SupplierKey] [int] NOT NULL,\n\t[StockItemKey] [int] NOT NULL,\n\t[WWIPurchaseOrderID] [int] NULL,\n\t[OrderedOuters] [int] NOT NULL,\n\t[OrderedQuantity] [int] NOT NULL,\n\t[ReceivedOuters] [int] NOT NULL,\n\t[Package] [nvarchar](50) NOT NULL,\n\t[IsOrderFinalized] [bit] NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = HASH ([SupplierKey]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nGO\n\nIF OBJECT_ID('wwi.FactSale', 'U') IS NOT NULL\n    DROP TABLE wwi.FactSale\nGO\n\nCREATE TABLE [wwi].[FactSale](\n\t[SaleKey] [bigint] IDENTITY(1,1) NOT NULL,\n\t[CityKey] [int] NOT NULL,\n\t[CustomerKey] [int] NOT NULL,\n\t[BillToCustomerKey] [int] NOT NULL,\n\t[StockItemKey] [int] NOT NULL,\n\t[InvoiceDateKey] [date] NOT NULL,\n\t[DeliveryDateKey] [date] NULL,\n\t[SalespersonKey] [int] NOT NULL,\n\t[WWIInvoiceID] [int] NOT NULL,\n\t[Description] [nvarchar](100) NOT NULL,\n\t[Package] [nvarchar](50) NOT NULL,\n\t[Quantity] [int] NOT NULL,\n\t[UnitPrice] [decimal](18, 2) NOT NULL,\n\t[TaxRate] [decimal](18, 3) NOT NULL,\n\t[TotalExcludingTax] [decimal](18, 2) NOT NULL,\n\t[TaxAmount] [decimal](18, 2) NOT NULL,\n\t[Profit] [decimal](18, 2) NOT NULL,\n\t[TotalIncludingTax] [decimal](18, 2) NOT NULL,\n\t[TotalDryItems] [int] NOT NULL,\n\t[TotalChillerItems] [int] NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = HASH ([CustomerKey]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nGO\n\nIF OBJECT_ID('wwi_perf.FactSale_Slow', 'U') IS NOT NULL\n    DROP TABLE wwi_perf.FactSale\nGO\n\nCREATE TABLE [wwi_perf].[FactSale_Slow](\n\t[SaleKey] [bigint] IDENTITY(1,1) NOT NULL,\n\t[CityKey] [int] NOT NULL,\n\t[CustomerKey] [int] NOT NULL,\n\t[BillToCustomerKey] [int] NOT NULL,\n\t[StockItemKey] [int] NOT NULL,\n\t[InvoiceDateKey] [date] NOT NULL,\n\t[DeliveryDateKey] [date] NULL,\n\t[SalespersonKey] [int] NOT NULL,\n\t[WWIInvoiceID] [int] NOT NULL,\n\t[Description] [nvarchar](100) NOT NULL,\n\t[Package] [nvarchar](50) NOT NULL,\n\t[Quantity] [int] NOT NULL,\n\t[UnitPrice] [decimal](18, 2) NOT NULL,\n\t[TaxRate] [decimal](18, 3) NOT NULL,\n\t[TotalExcludingTax] [decimal](18, 2) NOT NULL,\n\t[TaxAmount] [decimal](18, 2) NOT NULL,\n\t[Profit] [decimal](18, 2) NOT NULL,\n\t[TotalIncludingTax] [decimal](18, 2) NOT NULL,\n\t[TotalDryItems] [int] NOT NULL,\n\t[TotalChillerItems] [int] NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = ROUND_ROBIN,\n    CLUSTERED COLUMNSTORE INDEX\n)\nGO\n\nIF OBJECT_ID('wwi_perf.FactSale_Fast', 'U') IS NOT NULL\n    DROP TABLE wwi_perf.FactSale_Fast\nGO\n\nCREATE TABLE [wwi_perf].[FactSale_Fast](\n\t[SaleKey] [bigint] IDENTITY(1,1) NOT NULL,\n\t[CityKey] [int] NOT NULL,\n\t[CustomerKey] [int] NOT NULL,\n\t[BillToCustomerKey] [int] NOT NULL,\n\t[StockItemKey] [int] NOT NULL,\n\t[InvoiceDateKey] [date] NOT NULL,\n\t[DeliveryDateKey] [date] NULL,\n\t[SalespersonKey] [int] NOT NULL,\n\t[WWIInvoiceID] [int] NOT NULL,\n\t[Description] [nvarchar](100) NOT NULL,\n\t[Package] [nvarchar](50) NOT NULL,\n\t[Quantity] [int] NOT NULL,\n\t[UnitPrice] [decimal](18, 2) NOT NULL,\n\t[TaxRate] [decimal](18, 3) NOT NULL,\n\t[TotalExcludingTax] [decimal](18, 2) NOT NULL,\n\t[TaxAmount] [decimal](18, 2) NOT NULL,\n\t[Profit] [decimal](18, 2) NOT NULL,\n\t[TotalIncludingTax] [decimal](18, 2) NOT NULL,\n\t[TotalDryItems] [int] NOT NULL,\n\t[TotalChillerItems] [int] NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = HASH ([CustomerKey]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nGO\n\nIF OBJECT_ID('wwi.FactStockHolding', 'U') IS NOT NULL\n    DROP TABLE wwi.FactStockHolding\nGO\n\nCREATE TABLE [wwi].[FactStockHolding](\n\t[StockHoldingKey] [bigint] IDENTITY(1,1) NOT NULL,\n\t[StockItemKey] [int] NOT NULL,\n\t[QuantityOnHand] [int] NOT NULL,\n\t[BinLocation] [nvarchar](20) NOT NULL,\n\t[LastStocktakeQuantity] [int] NOT NULL,\n\t[LastCostPrice] [decimal](18, 2) NOT NULL,\n\t[ReorderLevel] [int] NOT NULL,\n\t[TargetStockLevel] [int] NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = HASH ([StockItemKey]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nGO\n\nIF OBJECT_ID('wwi.FactTransaction', 'U') IS NOT NULL\n    DROP TABLE wwi.FactTransaction\nGO\n\nCREATE TABLE [wwi].[FactTransaction](\n\t[TransactionKey] [bigint] IDENTITY(1,1) NOT NULL,\n\t[DateKey] [date] NOT NULL,\n\t[CustomerKey] [int] NULL,\n\t[BillToCustomerKey] [int] NULL,\n\t[SupplierKey] [int] NULL,\n\t[TransactionTypeKey] [int] NOT NULL,\n\t[PaymentMethodKey] [int] NULL,\n\t[WWICustomerTransaction ID] [int] NULL,\n\t[WWISupplierTransaction ID] [int] NULL,\n\t[WWIInvoiceID] [int] NULL,\n\t[WWIPurchaseOrderID] [int] NULL,\n\t[SupplierInvoiceNumber] [nvarchar](20) NULL,\n\t[TotalExcludingTax] [decimal](18, 2) NOT NULL,\n\t[TaxAmount] [decimal](18, 2) NOT NULL,\n\t[TotalIncludingTax] [decimal](18, 2) NOT NULL,\n\t[OutstandingBalance] [decimal](18, 2) NOT NULL,\n\t[IsFinalized] [bit] NOT NULL,\n\t[LineageKey] [int] NOT NULL\n)\nWITH\n(\n    DISTRIBUTION = HASH ([CustomerKey]),\n    CLUSTERED COLUMNSTORE INDEX\n)\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "Built-in",
				"databaseName": "master"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}